#!/bin/bash
set -euo pipefail

SRC=""
DST=""
TYPE="softlink"
LOG="INFO"

while [[ $# -gt 0 ]]; do
  case "$1" in
    --src-path)
      SRC="$2"; shift 2 ;;
    --dst-path)
      DST="$2"; shift 2 ;;
    --link-type)
      TYPE="$2"; shift 2 ;;
    --log-level)
      LOG="$2"; shift 2 ;;
    *)
      break ;;
  esac
done

if [[ -z "${SRC}" || -z "${DST}" ]]; then
  echo "[symlink] Missing source or destination" >&2
  exit 1
fi

case "${TYPE}" in
  softlink|symlink)
    ln -sfn "${SRC}" "${DST}" ;;
  hardlink)
    ln -fn "${SRC}" "${DST}" ;;
  *)
    echo "[symlink] Unknown link type ${TYPE}" >&2
    exit 1 ;;
 esac

echo "[symlink] (${LOG}) ${TYPE} ${SRC} -> ${DST}"
